{"version":3,"file":"index.js","sources":["rmodal.js"],"sourcesContent":["let is = (obj, type) => Object.prototype.toString.call(obj).toLowerCase() === `[object ${type}]`;\n\nlet addClass = (el, cls) => {\n    let arr = el.className\n    .split(/\\s+/)\n    .filter((c) => !!c && c == cls);\n\n    if (!arr.length) {\n        el.className += ` ${cls}`;\n    }\n};\n\nlet removeClass = (el, cls) => {\n    el.className = el.className\n    .split(/\\s+/)\n    .filter((c) => !!c && c != cls)\n    .join(' ');\n};\n\nclass RModal {\n    constructor(el, opts) {\n        this.opened = false;\n\n        this.opts = {\n            bodyClass: 'modal-open'\n            , dialogClass: 'modal-dialog'\n            , dialogOpenClass: 'bounceInDown'\n            , dialogCloseClass: 'bounceOutUp'\n\n            , focus: true\n            , focusElements: [\n                'a[href]', 'area[href]', 'input:not([disabled]):not([type=hidden])'\n                , 'button:not([disabled])', 'select:not([disabled])'\n                , 'textarea:not([disabled])', 'iframe', 'object', 'embed'\n                , '*[tabindex]', '*[contenteditable]'\n            ]\n\n            , escapeClose: true\n            , content: null\n            , closeTimeout: 500\n        };\n\n        Object.keys(opts || {})\n        .forEach((key) => {\n            /* istanbul ignore else */\n            if (opts[key] !== undefined) {\n                this.opts[key] = opts[key];\n            }\n        });\n\n        this.overlay = el;\n        this.dialog = el.querySelector(`.${this.opts.dialogClass}`);\n\n        if (this.opts.content) {\n            this.content(this.opts.content);\n        }\n    }\n\n    open(content) {\n        this.content(content);\n\n        if (!is(this.opts.beforeOpen, 'function')) {\n            return this._doOpen();\n        }\n\n        this.opts.beforeOpen(() => {\n            this._doOpen();\n        });\n    }\n\n    _doOpen() {\n        addClass(document.body, this.opts.bodyClass);\n\n        removeClass(this.dialog, this.opts.dialogCloseClass);\n        addClass(this.dialog, this.opts.dialogOpenClass);\n\n        this.overlay.style.display = 'block';\n\n        if (this.opts.focus) {\n            this.focusOutElement = document.activeElement;\n            this.focus();\n        }\n\n        if (is(this.opts.afterOpen, 'function')) {\n            this.opts.afterOpen();\n        }\n        this.opened = true;\n    }\n\n    close() {\n        if (!is(this.opts.beforeClose, 'function')) {\n            return this._doClose();\n        }\n\n        this.opts.beforeClose(() => {\n            this._doClose();\n        });\n    }\n\n    _doClose() {\n        removeClass(this.dialog, this.opts.dialogOpenClass);\n        addClass(this.dialog, this.opts.dialogCloseClass);\n\n        removeClass(document.body, this.opts.bodyClass);\n\n        if (this.opts.focus) {\n            this.focus(this.focusOutElement);\n        }\n\n        if (is(this.opts.afterClose, 'function')) {\n            this.opts.afterClose();\n        }\n\n        this.opened = false;\n        setTimeout(() => {\n            this.overlay.style.display = 'none';\n        }, this.opts.closeTimeout);\n    }\n\n    content(html) {\n        if (html === undefined) {\n            return this.dialog.innerHTML;\n        }\n\n        this.dialog.innerHTML = html;\n    }\n\n    elements(selector, fallback) {\n        fallback = fallback || window.navigator.appVersion.indexOf('MSIE 9.0') > -1;\n        selector = is(selector, 'array') ? selector.join(',') : selector;\n\n        return [].filter.call(\n            this.dialog.querySelectorAll(selector)\n            , (element) => {\n                if (fallback) {\n                    var style = window.getComputedStyle(element);\n                    return style.display !== 'none' && style.visibility !== 'hidden';\n                }\n\n                return element.offsetParent !== null;\n            }\n        );\n    }\n\n    focus(el) {\n        el = el || this.elements(this.opts.focusElements)[0] || this.dialog.firstChild;\n\n        if (el && is(el.focus, 'function')) {\n            el.focus();\n        }\n    }\n\n    keydown(ev) {\n        if (this.opts.escapeClose && ev.which == 27) {\n            this.close();\n        }\n\n        function stopEvent() {\n            ev.preventDefault();\n            ev.stopPropagation();\n        }\n\n        if (this.opened && ev.which == 9 && this.dialog.contains(ev.target)) {\n            var elements = this.elements(this.opts.focusElements)\n                , first = elements[0]\n                , last = elements[elements.length - 1];\n\n            if (first == last) {\n                stopEvent();\n            }\n            else if (ev.target == first && ev.shiftKey) {\n                stopEvent();\n                last.focus();\n            }\n            else if (ev.target == last && !ev.shiftKey) {\n                stopEvent();\n                first.focus();\n            }\n        }\n    }\n}\n\nRModal.prototype.version = '@@VERSION@@';\nRModal.version = '@@VERSION@@';\n\nexport default RModal;\n"],"names":["let"],"mappings":"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","preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy93aXNoL0Rlc2t0b3Avcm1vZGFsLmpzL3NyYy9ybW9kYWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsibGV0IGlzID0gKG9iaiwgdHlwZSkgPT4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikudG9Mb3dlckNhc2UoKSA9PT0gYFtvYmplY3QgJHt0eXBlfV1gO1xuXG5sZXQgYWRkQ2xhc3MgPSAoZWwsIGNscykgPT4ge1xuICAgIGxldCBhcnIgPSBlbC5jbGFzc05hbWVcbiAgICAuc3BsaXQoL1xccysvKVxuICAgIC5maWx0ZXIoKGMpID0+ICEhYyAmJiBjID09IGNscyk7XG5cbiAgICBpZiAoIWFyci5sZW5ndGgpIHtcbiAgICAgICAgZWwuY2xhc3NOYW1lICs9IGAgJHtjbHN9YDtcbiAgICB9XG59O1xuXG5sZXQgcmVtb3ZlQ2xhc3MgPSAoZWwsIGNscykgPT4ge1xuICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZVxuICAgIC5zcGxpdCgvXFxzKy8pXG4gICAgLmZpbHRlcigoYykgPT4gISFjICYmIGMgIT0gY2xzKVxuICAgIC5qb2luKCcgJyk7XG59O1xuXG5jbGFzcyBSTW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGVsLCBvcHRzKSB7XG4gICAgICAgIHRoaXMub3BlbmVkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vcHRzID0ge1xuICAgICAgICAgICAgYm9keUNsYXNzOiAnbW9kYWwtb3BlbidcbiAgICAgICAgICAgICwgZGlhbG9nQ2xhc3M6ICdtb2RhbC1kaWFsb2cnXG4gICAgICAgICAgICAsIGRpYWxvZ09wZW5DbGFzczogJ2JvdW5jZUluRG93bidcbiAgICAgICAgICAgICwgZGlhbG9nQ2xvc2VDbGFzczogJ2JvdW5jZU91dFVwJ1xuXG4gICAgICAgICAgICAsIGZvY3VzOiB0cnVlXG4gICAgICAgICAgICAsIGZvY3VzRWxlbWVudHM6IFtcbiAgICAgICAgICAgICAgICAnYVtocmVmXScsICdhcmVhW2hyZWZdJywgJ2lucHV0Om5vdChbZGlzYWJsZWRdKTpub3QoW3R5cGU9aGlkZGVuXSknXG4gICAgICAgICAgICAgICAgLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKScsICdzZWxlY3Q6bm90KFtkaXNhYmxlZF0pJ1xuICAgICAgICAgICAgICAgICwgJ3RleHRhcmVhOm5vdChbZGlzYWJsZWRdKScsICdpZnJhbWUnLCAnb2JqZWN0JywgJ2VtYmVkJ1xuICAgICAgICAgICAgICAgICwgJypbdGFiaW5kZXhdJywgJypbY29udGVudGVkaXRhYmxlXSdcbiAgICAgICAgICAgIF1cblxuICAgICAgICAgICAgLCBlc2NhcGVDbG9zZTogdHJ1ZVxuICAgICAgICAgICAgLCBjb250ZW50OiBudWxsXG4gICAgICAgICAgICAsIGNsb3NlVGltZW91dDogNTAwXG4gICAgICAgIH07XG5cbiAgICAgICAgT2JqZWN0LmtleXMob3B0cyB8fCB7fSlcbiAgICAgICAgLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgICAgICAgIGlmIChvcHRzW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0c1trZXldID0gb3B0c1trZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm92ZXJsYXkgPSBlbDtcbiAgICAgICAgdGhpcy5kaWFsb2cgPSBlbC5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLm9wdHMuZGlhbG9nQ2xhc3N9YCk7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0cy5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQodGhpcy5vcHRzLmNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb3Blbihjb250ZW50KSB7XG4gICAgICAgIHRoaXMuY29udGVudChjb250ZW50KTtcblxuICAgICAgICBpZiAoIWlzKHRoaXMub3B0cy5iZWZvcmVPcGVuLCAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RvT3BlbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vcHRzLmJlZm9yZU9wZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZG9PcGVuKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9kb09wZW4oKSB7XG4gICAgICAgIGFkZENsYXNzKGRvY3VtZW50LmJvZHksIHRoaXMub3B0cy5ib2R5Q2xhc3MpO1xuXG4gICAgICAgIHJlbW92ZUNsYXNzKHRoaXMuZGlhbG9nLCB0aGlzLm9wdHMuZGlhbG9nQ2xvc2VDbGFzcyk7XG4gICAgICAgIGFkZENsYXNzKHRoaXMuZGlhbG9nLCB0aGlzLm9wdHMuZGlhbG9nT3BlbkNsYXNzKTtcblxuICAgICAgICB0aGlzLm92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0cy5mb2N1cykge1xuICAgICAgICAgICAgdGhpcy5mb2N1c091dEVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzKHRoaXMub3B0cy5hZnRlck9wZW4sICdmdW5jdGlvbicpKSB7XG4gICAgICAgICAgICB0aGlzLm9wdHMuYWZ0ZXJPcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcGVuZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAoIWlzKHRoaXMub3B0cy5iZWZvcmVDbG9zZSwgJ2Z1bmN0aW9uJykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kb0Nsb3NlKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdHMuYmVmb3JlQ2xvc2UoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZG9DbG9zZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfZG9DbG9zZSgpIHtcbiAgICAgICAgcmVtb3ZlQ2xhc3ModGhpcy5kaWFsb2csIHRoaXMub3B0cy5kaWFsb2dPcGVuQ2xhc3MpO1xuICAgICAgICBhZGRDbGFzcyh0aGlzLmRpYWxvZywgdGhpcy5vcHRzLmRpYWxvZ0Nsb3NlQ2xhc3MpO1xuXG4gICAgICAgIHJlbW92ZUNsYXNzKGRvY3VtZW50LmJvZHksIHRoaXMub3B0cy5ib2R5Q2xhc3MpO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdHMuZm9jdXMpIHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXModGhpcy5mb2N1c091dEVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzKHRoaXMub3B0cy5hZnRlckNsb3NlLCAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgdGhpcy5vcHRzLmFmdGVyQ2xvc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub3BlbmVkID0gZmFsc2U7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH0sIHRoaXMub3B0cy5jbG9zZVRpbWVvdXQpO1xuICAgIH1cblxuICAgIGNvbnRlbnQoaHRtbCkge1xuICAgICAgICBpZiAoaHRtbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaWFsb2cuaW5uZXJIVE1MO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5kaWFsb2cuaW5uZXJIVE1MID0gaHRtbDtcbiAgICB9XG5cbiAgICBlbGVtZW50cyhzZWxlY3RvciwgZmFsbGJhY2spIHtcbiAgICAgICAgZmFsbGJhY2sgPSBmYWxsYmFjayB8fCB3aW5kb3cubmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZignTVNJRSA5LjAnKSA+IC0xO1xuICAgICAgICBzZWxlY3RvciA9IGlzKHNlbGVjdG9yLCAnYXJyYXknKSA/IHNlbGVjdG9yLmpvaW4oJywnKSA6IHNlbGVjdG9yO1xuXG4gICAgICAgIHJldHVybiBbXS5maWx0ZXIuY2FsbChcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpXG4gICAgICAgICAgICAsIChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnICYmIHN0eWxlLnZpc2liaWxpdHkgIT09ICdoaWRkZW4nO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50Lm9mZnNldFBhcmVudCAhPT0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmb2N1cyhlbCkge1xuICAgICAgICBlbCA9IGVsIHx8IHRoaXMuZWxlbWVudHModGhpcy5vcHRzLmZvY3VzRWxlbWVudHMpWzBdIHx8IHRoaXMuZGlhbG9nLmZpcnN0Q2hpbGQ7XG5cbiAgICAgICAgaWYgKGVsICYmIGlzKGVsLmZvY3VzLCAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgZWwuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGtleWRvd24oZXYpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0cy5lc2NhcGVDbG9zZSAmJiBldi53aGljaCA9PSAyNykge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3RvcEV2ZW50KCkge1xuICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMub3BlbmVkICYmIGV2LndoaWNoID09IDkgJiYgdGhpcy5kaWFsb2cuY29udGFpbnMoZXYudGFyZ2V0KSkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5lbGVtZW50cyh0aGlzLm9wdHMuZm9jdXNFbGVtZW50cylcbiAgICAgICAgICAgICAgICAsIGZpcnN0ID0gZWxlbWVudHNbMF1cbiAgICAgICAgICAgICAgICAsIGxhc3QgPSBlbGVtZW50c1tlbGVtZW50cy5sZW5ndGggLSAxXTtcblxuICAgICAgICAgICAgaWYgKGZpcnN0ID09IGxhc3QpIHtcbiAgICAgICAgICAgICAgICBzdG9wRXZlbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LnRhcmdldCA9PSBmaXJzdCAmJiBldi5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIHN0b3BFdmVudCgpO1xuICAgICAgICAgICAgICAgIGxhc3QuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LnRhcmdldCA9PSBsYXN0ICYmICFldi5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIHN0b3BFdmVudCgpO1xuICAgICAgICAgICAgICAgIGZpcnN0LmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cblJNb2RhbC5wcm90b3R5cGUudmVyc2lvbiA9ICdAQFZFUlNJT05AQCc7XG5STW9kYWwudmVyc2lvbiA9ICdAQFZFUlNJT05AQCc7XG5cbmV4cG9ydCBkZWZhdWx0IFJNb2RhbDtcbiJdLCJuYW1lcyI6WyJsZXQiXSwibWFwcGluZ3MiOiI7O0FBQUFBLElBQUksRUFBRSxhQUFJLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLG1CQUFnQixJQUFJLFVBQUcsQ0FBQzs7QUFFakdBLElBQUksUUFBUSxhQUFJLEVBQUUsRUFBRSxHQUFHLEVBQUU7SUFDckJBLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQyxTQUFT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"}